<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Chismes â€” Neon</title>
<style>
  :root{
    --bg:#0d0f15;
    --card-bg: linear-gradient(circle at top left, #1a1c25 0%, #0c0d12 100%);
    --neon-pink: #ff2ea6;
    --neon-purple: #b832ff;
    --accent: #ff2c7d;
    --muted:#d8d8e0;
  }

  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:var(--muted);
    font-family:Inter, "Segoe UI", Arial, sans-serif;
    padding-bottom:40px;
  }

  h1{ text-align:center; color:var(--neon-pink); text-shadow:0 0 10px var(--neon-pink); margin:20px 0 8px; font-weight:600; }
  h2{ text-align:center; color:var(--neon-purple); margin:8px 0 18px; font-weight:500; }

  .chisme-form{
    width:95%; max-width:1200px; margin: 0 auto 22px; display:flex; gap:12px;
    padding:14px; background:#0f1116; border-top:3px solid var(--accent); border-radius:12px;
    align-items:center; flex-wrap:wrap;
  }
  .input-box{ padding:10px; border-radius:10px; background:#0b0d12; border:1px solid rgba(123,44,191,0.25); color:white; }
  .xat-input{ width:170px; min-width:120px; }
  .chisme-input{ flex:1; min-width:260px; height:110px; resize:vertical; font-size:15px; padding:12px; }
  .url-input{ width:260px; padding:10px; border-radius:10px; background:#0b0d12; border:1px solid rgba(123,44,191,0.15); color:white; }
  .add-screenshot{ width:40px; height:40px; border-radius:8px; border:none; background:var(--accent); color:#fff; font-size:22px; cursor:pointer; }
  .add-btn{ padding:10px 18px; background:var(--accent); border:none; border-radius:10px; color:white; cursor:pointer; font-weight:700; }

  .chismes-wrapper{ width:95%; max-width:1200px; margin: 10px auto 40px; padding:20px; background:var(--card-bg);
    border:3px solid var(--neon-pink); border-radius:18px; box-shadow: 0 0 25px var(--neon-pink), inset 0 0 15px #b832ff55;
    max-height:520px; overflow-y:auto; }
  .chismes-wrapper::-webkit-scrollbar{ width:10px }
  .chismes-wrapper::-webkit-scrollbar-thumb{ background:var(--neon-pink); border-radius:10px }

  #listaChismes{ display:flex; flex-direction:column; gap:12px; padding-right:8px; }

  .chisme-card{
    display:flex; align-items:center; gap:18px; background:var(--card-bg); border:3px solid var(--neon-pink);
    border-radius:18px; box-shadow: 0 0 15px var(--neon-pink), inset 0 0 10px #b832ff55; padding:16px; transition:transform .18s ease;
  }
  .chisme-card:hover{ transform:scale(1.02); box-shadow:0 0 28px var(--neon-pink), inset 0 0 15px #b832ff88; }
  .chisme-icon{ width:84px; height:84px; border-radius:50%; background:linear-gradient(145deg,var(--neon-pink),var(--neon-purple));
    display:flex; align-items:center; justify-content:center; font-size:38px; color:white; box-shadow:0 0 18px var(--neon-pink); flex-shrink:0; }
  .chisme-texto{ flex:1; font-size:15px; color:var(--muted); line-height:1.5; word-break:break-word; }
  .chisme-texto strong{ color:var(--neon-pink); font-size:15.5px; display:block; margin-bottom:4px; }
  .btn-ver{ background:transparent; border:3px solid var(--neon-purple); color:var(--neon-purple); padding:12px 20px;
    border-radius:14px; font-weight:700; cursor:pointer; box-shadow:0 0 10px #b832ff55; }

  .modal-bg{ position:fixed; inset:0; display:none; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; padding:20px; z-index:999; }
  .modal{ width:92%; max-width:720px; background:#0e0f14; border-radius:14px; padding:18px; border:1px solid var(--accent);
    box-shadow:0 0 32px #ff2c7d; max-height:85vh; overflow:hidden; display:flex; flex-direction:column; gap:12px; }
  .modal-top{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
  .modal h3{ margin:0; color:var(--neon-pink); text-shadow:0 0 8px var(--neon-pink) }
  .close-modal{ cursor:pointer; color:var(--accent); font-size:22px; border:none; background:transparent; }

  .modal-body{ overflow-y:auto; padding-right:8px; max-height:60vh; }
  .modal-body::-webkit-scrollbar{ width:10px }
  .modal-body::-webkit-scrollbar-thumb{ background:var(--neon-purple); border-radius:10px }

  #modal-chisme{ white-space:pre-wrap; color:var(--muted); font-size:15px; line-height:1.6; margin-bottom:10px; }

  #modal-capturas{ display:flex; flex-direction:column; gap:8px; margin-top:6px; }
  #modal-capturas a{ display:block; text-decoration:none; padding:10px 12px; border-radius:10px;
    border:2px solid rgba(184,50,255,0.18); background:linear-gradient(90deg, rgba(255,46,166,0.03), rgba(184,50,255,0.02));
    color:var(--neon-pink); font-weight:700; box-shadow:0 0 10px rgba(184,50,255,0.06); word-break:break-word; }
  #modal-capturas a:hover{ transform:translateY(-2px); box-shadow:0 6px 20px rgba(184,50,255,0.14); }

  .cap-thumb{ max-width:100%; border-radius:8px; margin-bottom:8px; box-shadow:0 0 12px rgba(184,50,255,0.08); }
  @media (max-width:700px){ .chisme-icon{ width:64px; height:64px; font-size:30px } .btn-ver{ padding:10px 14px; font-size:14px } .chisme-input{ height:90px } }
</style>
</head>
<body>

  <h1>ðŸ˜±ðŸ”¥ Chisme del DÃ­a</h1>
  <h2>AquÃ­ los rumores se cuentan primero. Â¡Ãšnete y entÃ©rate de todo!</h2>

  <!-- Chisme del DÃ­a: comeÃ§a escondido se vazio -->
  <div id="chismeDiaContainer" style="display:none;width:95%;max-width:1200px;margin:0 auto 12px;"></div>

  <h2 style="margin-top:2px;color:var(--neon-pink)">ðŸ“š Chismes Antiguos</h2>
  <div class="chismes-wrapper">
    <div id="listaChismes"></div>
  </div>

  <!-- FORM -->
  <div class="chisme-form" role="form" aria-label="Form para chismes">
    <input class="input-box xat-input" id="xat" placeholder="Â¿Chisme de cuÃ¡l xat?" />
    <textarea class="input-box chisme-input" id="chisme" placeholder="Escribe tu chisme..."></textarea>

    <div id="capturas-container" style="display:flex; gap:10px; flex-wrap:wrap;"></div>

    <button class="add-screenshot" id="add-cap" title="AÃ±adir campo de captura">+</button>
    <button class="add-btn" id="add" title="AÃ±adir chisme">AÃ±adir Chisme</button>
  </div>

  <!-- MODAL -->
  <div class="modal-bg" id="modal" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-xat">
      <div class="modal-top">
        <h3 id="modal-xat"></h3>
        <button class="close-modal" id="closeBtn" aria-label="Cerrar modal">Ã—</button>
      </div>
      <div class="modal-body">
        <div id="modal-chisme"></div>
        <div id="modal-capturas"></div>
      </div>
    </div>
  </div>

<script>
/* ======== Storage format (opÃ§Ã£o 2 â€“ organizado) ========
localStorage key: "chismesApp_v2"
value example:
{
  chismeDia: { xat, texto, capturas: [] } ,
  antiguos: [ { xat, texto, capturas: [] }, ... ]
}
*/

const STORAGE_KEY = "chismesApp_v2";

/* util: extrai urls do texto (http/https) */
function extractUrls(text){
  if(!text) return [];
  const urlRegex = /https?:\/\/[^\s]+/g;
  const matches = text.match(urlRegex);
  return matches ? matches.map(s => s.trim()) : [];
}

/* util: detecta se url parece imagem */
function looksLikeImage(url){
  return /\.(png|jpe?g|gif|webp|bmp|svg)(\?.*)?$/i.test(url) || url.startsWith('/mnt/data/');
}

/* escape html */
function escapeHtml(str){
  if(!str) return '';
  return String(str)
    .replaceAll('&','&amp;')
    .replaceAll('<','&lt;')
    .replaceAll('>','&gt;')
    .replaceAll('"','&quot;')
    .replaceAll("'",'&#039;');
}

/* DOM refs */
const lista = document.getElementById('listaChismes');
const chismeDiaContainer = document.getElementById('chismeDiaContainer');
const capturasContainer = document.getElementById('capturas-container');
const modalBg = document.getElementById('modal');
const modalXat = document.getElementById('modal-xat');
const modalChisme = document.getElementById('modal-chisme');
const modalCapturas = document.getElementById('modal-capturas');
document.getElementById('closeBtn').onclick = closeModal;

/* create capture input */
function createCaptureInput(value=''){
  const wrapper = document.createElement('div');
  wrapper.style.display = 'flex';
  wrapper.style.gap = '6px';
  wrapper.style.alignItems = 'center';

  const input = document.createElement('input');
  input.className = 'input-box url-input';
  input.placeholder = 'URL de captura (opcional)';
  input.value = value;

  const btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'remove-cap';
  btn.textContent = 'âˆ’';
  btn.onclick = () => { wrapper.remove(); };

  wrapper.appendChild(input);
  wrapper.appendChild(btn);
  capturasContainer.appendChild(wrapper);
  return input;
}
createCaptureInput();
document.getElementById('add-cap').onclick = () => createCaptureInput();

/* ===== Storage helpers ===== */
function loadState(){
  try {
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return { chismeDia: null, antiguos: [] };
    return JSON.parse(raw);
  } catch(e){
    console.error("Error reading storage", e);
    return { chismeDia: null, antiguos: [] };
  }
}
function saveState(state){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

/* ===== render functions ===== */
function renderAll(){
  const state = loadState();
  renderChismeDia(state.chismeDia);
  renderAntiguos(state.antiguos);
}

function renderChismeDia(ch){
  if(!ch){
    chismeDiaContainer.style.display = "none";
    chismeDiaContainer.innerHTML = "";
    return;
  }
  chismeDiaContainer.style.display = "block";
  chismeDiaContainer.innerHTML = '';

  const card = createCardElement(ch.xat, ch.texto, ch.capturas);
  chismeDiaContainer.appendChild(card);
}

function renderAntiguos(arr){
  lista.innerHTML = '';
  if(!Array.isArray(arr) || arr.length === 0){
    // mostra um espaÃ§o agradÃ¡vel ou mensagem (opcional)
    const empty = document.createElement('div');
    empty.style.opacity = '0.6';
    empty.style.padding = '12px';
    empty.textContent = "No hay chismes antiguos todavÃ­a.";
    lista.appendChild(empty);
    return;
  }
  arr.forEach(item => {
    const card = createCardElement(item.xat, item.texto, item.capturas);
    lista.appendChild(card);
  });
}

/* cria o elemento visual do card */
function createCardElement(xat, texto, capturas){
  const card = document.createElement('div');
  card.className = 'chisme-card';

  const icon = document.createElement('div');
  icon.className = 'chisme-icon';
  icon.textContent = 'ðŸ’¬';

  const body = document.createElement('div');
  body.className = 'chisme-texto';
  const strong = document.createElement('strong');
  strong.innerHTML = escapeHtml(xat || 'Xat desconocido');
  const preview = document.createElement('div');
  const previewText = texto.length > 140 ? texto.slice(0,140) + 'â€¦' : texto;
  preview.innerHTML = escapeHtml(previewText);

  body.appendChild(strong);
  body.appendChild(preview);

  const btn = document.createElement('button');
  btn.className = 'btn-ver';
  btn.textContent = 'Visualizar';
  btn.onclick = () => openModal(xat, texto, capturas);

  card.appendChild(icon);
  card.appendChild(body);
  card.appendChild(btn);

  return card;
}

/* open modal â€” mostra o texto completo e as capturas em coluna */
function openModal(xat, chismeText, captures){
  modalXat.textContent = xat ? `Xat: ${xat}` : 'Xat: Desconocido';
  modalChisme.innerHTML = escapeHtml(chismeText || '');

  modalCapturas.innerHTML = '';

  // capta capturas passadas via campo e inline no texto
  let urls = Array.isArray(captures) ? captures.slice() : [];
  urls = urls.concat(extractUrls(chismeText));
  urls = Array.from(new Set(urls.filter(u => !!u)));

  if(urls.length === 0){
    const no = document.createElement('div');
    no.innerHTML = "<em style='color:var(--accent)'>Sin capturas</em>";
    modalCapturas.appendChild(no);
  } else {
    urls.forEach(u => {
      // se for imagem: mostrar thumbnail + link
      if(looksLikeImage(u)){
        const img = document.createElement('img');
        img.src = u;
        img.alt = 'captura';
        img.className = 'cap-thumb';
        // tenta adicionar imagem (pode falhar se CORS bloquear)
        modalCapturas.appendChild(img);
      }
      const a = document.createElement('a');
      a.href = u;
      a.target = '_blank';
      a.rel = 'noopener noreferrer';
      a.textContent = u;
      modalCapturas.appendChild(a);
    });
  }

  modalBg.style.display = 'flex';
  modalBg.setAttribute('aria-hidden','false');
}

/* fechar modal */
modalBg.addEventListener('click', (e) => { if(e.target === modalBg) closeModal(); });
function closeModal(){ modalBg.style.display = 'none'; modalBg.setAttribute('aria-hidden','true'); }
document.addEventListener('keydown', (e) => { if(e.key === 'Escape' && modalBg.style.display === 'flex') closeModal(); });

/* ===== adicionar chisme: salva no state organizado ===== */
document.getElementById('add').onclick = () => {
  const xat = document.getElementById('xat').value.trim() || 'Xat desconocido';
  const chismeText = document.getElementById('chisme').value.trim();
  if(!chismeText) { alert('Escribe un chisme.'); return; }

  // capturas manuais (campos do form)
  const manualCapturas = [...capturasContainer.querySelectorAll('input')]
    .map(i => i.value.trim())
    .filter(v => v.length>0);

  // state atual
  const state = loadState();

  // se jÃ¡ existe chismeDia, move ele para antiguos antes de substituir
  if(state.chismeDia){
    const previous = state.chismeDia;
    state.antiguos = state.antiguos || [];
    // manter tamanho razoÃ¡vel dos antiguos (opcional) â€” aqui guardamos ilimitado
    state.antiguos.unshift(previous);
  }

  // novo chismeDia
  state.chismeDia = { xat, texto: chismeText, capturas: manualCapturas };

  // salva e re-render
  saveState(state);
  renderAll();

  // limpa form
  document.getElementById('xat').value = '';
  document.getElementById('chisme').value = '';
  capturasContainer.innerHTML = '';
  createCaptureInput();
};

/* ===== Inicializa: carrega do storage ao abrir a pÃ¡gina ===== */
renderAll();

/* ===== opÃ§Ã£o: colocar um exemplo inicial (comentado) =====
Uncomment se quiser prÃ©-popular com uma imagem local de exemplo:
const state0 = loadState();
if(!state0.chismeDia && state0.antiguos.length===0){
  state0.antiguos.push({
    xat: "Warari",
    texto: "Exemplo de chisme con capturas locales y enlaces.",
    capturas: ["/mnt/data/7d2e7e1a-32e0-4e10-985e-c133c1123d81.png"]
  });
  saveState(state0);
  renderAll();
}
*/

</script>
</body>
</html>
